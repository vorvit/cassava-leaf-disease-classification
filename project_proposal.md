**CassavaVision: Industrial-Grade Plant Disease Diagnosis**

**Постановка задачи**

Разработка системы компьютерного зрения для автоматической диагностики заболеваний маниоки (кассавы) по фотографиям листьев. Маниока является критически важным источником углеводов для миллионов людей в Африке, но урожаи часто страдают от вирусных заболеваний. Ручная диагностика требует экспертных знаний, которые не всегда доступны фермерам.

Цель проекта — создать надежный MLOps-пайплайн для обучения и деплоя модели классификации изображений, способной различать 5 категорий (4 типа болезней + здоровые листья). Проект будет построен как полноценный индустриальный сервис с воспроизводимым циклом обучения и оптимизированным инференсом.

На данном учебном примере планируется изучить и отработать навыки использования MLOps-инструментов на задаче компьютерного зрения.

**Формат входных и выходных данных**

Протокол взаимодействия с сервисом (API):

- **Входные данные**:
  - Изображение в формате JPEG/PNG (binary payload).
  - Ожидаемая размерность тензора после предобработки: `(B, 3, 512, 512)` или `(B, 3, 380, 380)` в зависимости от бэкенда модели.
- **Выходные данные**:
  - JSON объект вида: `{"predicted_class_id": int, "class_name": str, "confidence": float, "probabilities": dict[str, float]}`.
  - 5 классов: Cassava Bacterial Blight (0), Cassava Brown Streak Disease (1), Cassava Green Mottle (2), Cassava Mosaic Disease (3), Healthy (4).

**Метрики**

- **Accuracy**: Основная метрика соревнования Kaggle. Бизнес-интерпретируемая метрика для конечного пользователя ("как часто бот прав"). Ожидаемый уровень: >0.88 (на основе SOTA решений прошлых лет).
- **F1-Macro**: Техническая метрика, необходимая из-за сильного дисбаланса классов в датасете (класс CMD доминирует). Она позволит отследить качество работы модели на редких видах болезней, чтобы модель не скатывалась в предсказание мажоритарного класса.

**Валидация и тест**

- **Стратегия**: Stratified K-Fold Cross-Validation (5 folds). Это критично для имбалансных данных, чтобы гарантировать пропорциональное представление всех классов в каждом фолде.
- **Воспроизводимость**: Фиксация глобальных сидов (`torch.manual_seed`, `np.random.seed`) и использование `dvc` для версионирования конкретных сплитов данных (train/val/test).
- **Тест**: Отложенная выборка (hold-out), которая не участвует в кросс-валидации и используется только для финальной оценки перед деплоем.

**Датасеты**

Используется датасет **Cassava Leaf Disease Classification** (с платформы Kaggle, соревнование 2020 года).

- **Ссылка**: [https://www.kaggle.com/c/cassava-leaf-disease-classification/data](https://www.kaggle.com/c/cassava-leaf-disease-classification/data)
- **Объем**: 21,397 аннотированных изображений.
- **Особенности**:
  - Присутствует шум в разметке (noisy labels), что потребует использования техник вроде Label Smoothing или специфических лоссов (Bi-Tempered Logistic Loss).
  - Сильный дисбаланс (класс 3 составляет ~61% данных).
  - Изображения "в полевых условиях": разное освещение, ракурсы, фон.

**Моделирование**

**Бейзлайн**
Fine-tuning легковесной модели **ResNet18** или **MobileNetV3**, предобученной на ImageNet.

- Простая аугментация (Resize, Normalize).
- Обучение с использованием PyTorch Lightning для быстрого прототипирования.
- Целевая метрика бейзлайна: Accuracy ~0.80.

**Основная модель**
Ансамбль (Ensemble) из нескольких тяжелых архитектур для достижения максимальной точности:

1.  **EfficientNet-B4** (или B3) — стандарт де-факто для задач классификации изображений. Возможен semi-supervised подход для шумных данных.
2.  **Vision Transformer (ViT Base 384)** — для захвата глобальных контекстов на листе.

- **Инструменты**: `PyTorch`, `Hydra` (конфигурация), `uv` (менеджмент зависимостей), `Albumentations` (продвинутые аугментации), `WandB` или `MLFlow` (логирование).
- **Оптимизация**: Конвертация обученных моделей в **TensorRT** (FP16 precision) для ускорения инференса на GPU.

**Внедрение**

Модель будет развернута с использованием **NVIDIA Triton Inference Server**.
Архитектура сервиса (`model_repository`):

1.  **Preprocessing Model**: Кастомный Python-бэкенд или DALI pipeline для декодирования изображений и нормализации на GPU.
2.  **Inference Ensemble**: Triton Ensemble, который параллельно опрашивает модели (TensorRT engines) и усредняет их предсказания (Voting).
3.  **Интерфейс**:
    - Снаружи Triton будет закрыт REST API сервисом на **FastAPI**.
    - В качестве клиентского приложения — Telegram-бот для отправки фото листьев.

- Весь пайплайн (обучение и деплой) будет автоматизирован через GitHub Actions.
